{% extends 'tasks/base.html' %}
{% block title %}Registr√°cia - Task Manager{% endblock %}

{% block content %}
<div class="form-container">
    <div style="text-align: center; margin-bottom: 2rem;">
        <div style="font-size: 4rem; margin-bottom: 1rem;">üìù</div>
        <h2>Vytvorenie nov√©ho √∫ƒçtu</h2>
        <p style="color: #718096; margin-top: 0.5rem;">
            Zaregistrujte sa a zaƒçnite organizova≈• svoje √∫lohy
        </p>
    </div>

    <form method="post" class="register-form">
        {% csrf_token %}

        {% if form.non_field_errors %}
            <div style="background: #fed7d7; color: #742a2a; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; border-left: 4px solid #e53e3e;">
                {% for error in form.non_field_errors %}
                    <p style="margin: 0;">{{ error }}</p>
                {% endfor %}
            </div>
        {% endif %}

        <!-- Username pole -->
        <div class="form-group">
            <label for="{{ form.username.id_for_label }}">
                üë§ Pou≈æ√≠vateƒæsk√© meno
            </label>
            {{ form.username }}
            {% if form.username.errors %}
                <ul class="errorlist">
                    {% for error in form.username.errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
            <small style="color: #718096; font-size: 0.8rem;">
                Iba p√≠smen√°, ƒç√≠slice a @/./+/-/_ znaky
            </small>
        </div>

        <!-- Email pole (ak je v allauth forme) -->
        {% if form.email %}
            <div class="form-group">
                <label for="{{ form.email.id_for_label }}">
                    üìß Email adresa
                </label>
                {{ form.email }}
                {% if form.email.errors %}
                    <ul class="errorlist">
                        {% for error in form.email.errors %}
                            <li>{{ error }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
                <small style="color: #718096; font-size: 0.8rem;">
                    Na tento email v√°m po≈°leme potvrdzuj√∫ci odkaz
                </small>
            </div>
        {% endif %}

        <!-- Heslo pole -->
        <div class="form-group">
            <label for="{{ form.password1.id_for_label }}">
                üîí Heslo
            </label>
            {{ form.password1 }}
            {% if form.password1.errors %}
                <ul class="errorlist">
                    {% for error in form.password1.errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
            <small style="color: #718096; font-size: 0.8rem;">
                Minim√°lne 8 znakov, nesmie by≈• pr√≠li≈° jednoduch√©
            </small>
        </div>

        <!-- Potvrdenie hesla -->
        <div class="form-group">
            <label for="{{ form.password2.id_for_label }}">
                üîê Potvrdenie hesla
            </label>
            {{ form.password2 }}
            {% if form.password2.errors %}
                <ul class="errorlist">
                    {% for error in form.password2.errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
            <small style="color: #718096; font-size: 0.8rem;">
                Zadajte rovnak√© heslo ako vy≈°≈°ie
            </small>
        </div>

        <!-- S√∫hlas s podmienkami -->
        <div class="form-group" style="background: #f0fff4; padding: 1rem; border-radius: 8px; border-left: 4px solid #38a169;">
            <div style="display: flex; align-items: flex-start; gap: 0.5rem;">
                <input type="checkbox" id="terms-agreement" required style="margin-top: 0.25rem;">
                <label for="terms-agreement" style="margin: 0; color: #22543d; font-size: 0.9rem;">
                    ‚úÖ S√∫hlas√≠m s podmienkami pou≈æ√≠vania a spracovan√≠m osobn√Ωch √∫dajov v s√∫lade s GDPR
                </label>
            </div>
        </div>

        <!-- Tlaƒçidlo registr√°cie -->
        <div style="margin: 2rem 0;">
            <button type="submit" class="btn btn-success" style="width: 100%; justify-content: center; font-size: 1.1rem; padding: 1rem;">
                üöÄ Vytvori≈• √∫ƒçet
            </button>
        </div>
    </form>

    <!-- Odkazy -->
    <div style="text-align: center; margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #e2e8f0;">
        <p style="color: #718096; margin-bottom: 1rem;">
            U≈æ m√°te √∫ƒçet?
        </p>
        <a href="{% url 'account_login' %}" class="btn btn-secondary">
            üîë Prihl√°si≈• sa
        </a>
    </div>
</div>

<style>
/* ≈†pecifick√© ≈°t√Ωly pre registr√°ciu */
.register-form input[type="text"],
.register-form input[type="email"],
.register-form input[type="password"] {
    font-size: 1rem;
    padding: 0.875rem;
}

.register-form input[type="checkbox"] {
    width: auto;
    transform: scale(1.2);
}

/* Progress indik√°tor pre silu hesla */
.password-strength {
    height: 4px;
    background: #e2e8f0;
    border-radius: 2px;
    margin-top: 0.5rem;
    overflow: hidden;
}

.password-strength-bar {
    height: 100%;
    transition: all 0.3s ease;
    border-radius: 2px;
}

.strength-weak { background: #f56565; width: 25%; }
.strength-medium { background: #ed8936; width: 50%; }
.strength-good { background: #48bb78; width: 75%; }
.strength-strong { background: #38a169; width: 100%; }

/* Anim√°cie */
.form-container {
    animation: slideInUp 0.6s ease-out;
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Responz√≠vny dizajn */
@media (max-width: 768px) {
    .form-container {
        margin: 1rem;
        padding: 1.5rem;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-focus na pou≈æ√≠vateƒæsk√© meno
    const usernameInput = document.querySelector('input[name="username"]');
    if (usernameInput) {
        usernameInput.focus();
    }

    // Kontrola sily hesla
    const password1 = document.querySelector('input[name="password1"]');
    if (password1) {
        // Vytvorenie indik√°tora sily hesla
        const strengthIndicator = document.createElement('div');
        strengthIndicator.className = 'password-strength';
        strengthIndicator.innerHTML = '<div class="password-strength-bar"></div>';

        const strengthBar = strengthIndicator.querySelector('.password-strength-bar');
        password1.parentNode.appendChild(strengthIndicator);

        password1.addEventListener('input', function() {
            const value = this.value;
            let strength = 0;

            // Kontrola r√¥znych krit√©ri√≠
            if (value.length >= 8) strength++;
            if (/[a-z]/.test(value)) strength++;
            if (/[A-Z]/.test(value)) strength++;
            if (/[0-9]/.test(value)) strength++;
            if (/[^A-Za-z0-9]/.test(value)) strength++;

            // Nastavenie triedy na z√°klade sily
            strengthBar.className = 'password-strength-bar';
            if (strength >= 4) strengthBar.classList.add('strength-strong');
            else if (strength >= 3) strengthBar.classList.add('strength-good');
            else if (strength >= 2) strengthBar.classList.add('strength-medium');
            else if (strength >= 1) strengthBar.classList.add('strength-weak');
        });
    }

    // Kontrola zhody hesiel
    const password2 = document.querySelector('input[name="password2"]');
    if (password1 && password2) {
        const checkPasswords = () => {
            if (password2.value && password1.value !== password2.value) {
                password2.style.borderColor = '#f56565';
                password2.style.boxShadow = '0 0 0 3px rgba(245, 101, 101, 0.1)';
            } else if (password2.value) {
                password2.style.borderColor = '#48bb78';
                password2.style.boxShadow = '0 0 0 3px rgba(72, 187, 120, 0.1)';
            } else {
                password2.style.borderColor = '#e2e8f0';
                password2.style.boxShadow = 'none';
            }
        };

        password1.addEventListener('input', checkPasswords);
        password2.addEventListener('input', checkPasswords);
    }

    // Valid√°cia formul√°ra
    const form = document.querySelector('.register-form');
    if (form) {
        form.addEventListener('submit', function(e) {
            const username = document.querySelector('input[name="username"]').value.trim();
            const password1Val = password1.value;
            const password2Val = password2.value;
            const termsChecked = document.querySelector('#terms-agreement').checked;

            if (!username) {
                e.preventDefault();
                alert('Zadajte pros√≠m pou≈æ√≠vateƒæsk√© meno!');
                return false;
            }

            if (password1Val.length < 8) {
                e.preventDefault();
                alert('Heslo mus√≠ ma≈• aspo≈à 8 znakov!');
                return false;
            }

            if (password1Val !== password2Val) {
                e.preventDefault();
                alert('Hesl√° sa nezhoduj√∫!');
                return false;
            }

            if (!termsChecked) {
                e.preventDefault();
                alert('Mus√≠te s√∫hlasi≈• s podmienkami pou≈æ√≠vania!');
                return false;
            }

            // Loading indik√°tor
            const submitBtn = form.querySelector('button[type="submit"]');
            submitBtn.innerHTML = '‚è≥ Vytv√°ram √∫ƒçet...';
            submitBtn.disabled = true;
        });
    }
});
</script>
{% endblock %}