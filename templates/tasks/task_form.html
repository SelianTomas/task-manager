{% extends 'tasks/base.html' %}

{% block body_class %}{% if form.instance.pk %}page-task-edit{% else %}page-task-create{% endif %}{% endblock %}

{% block title %}
    {% if form.instance.pk %}Upravi≈• √∫lohu{% else %}Nov√° √∫loha{% endif %} - Task Manager
{% endblock %}

{% block content %}
<div class="form-container">
    <h2>
        {% if form.instance.pk %}
            ‚úèÔ∏è Upravi≈• √∫lohu
        {% else %}
            ‚ûï Nov√° √∫loha
        {% endif %}
    </h2>

    <form method="post" class="task-form" novalidate>
        {% csrf_token %}

        <!-- N√°zov √∫lohy -->
        <div class="form-group">
            <label for="{{ form.title.id_for_label }}">
                üìå N√°zov √∫lohy *
            </label>
            {{ form.title }}
            {% if form.title.errors %}
                <ul class="errorlist">
                    {% for error in form.title.errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        </div>

        <!-- Popis √∫lohy -->
        <div class="form-group">
            <label for="{{ form.description.id_for_label }}">
                üìù Popis √∫lohy
            </label>
            {{ form.description }}
            {% if form.description.errors %}
                <ul class="errorlist">
                    {% for error in form.description.errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
            <small style="color: #718096; font-size: 0.8rem;">
                Voliteƒæn√Ω popis pre lep≈°ie definovanie √∫lohy
            </small>
        </div>

        <!-- Term√≠n splnenia -->
        <div class="form-group">
            <label for="{{ form.due_date.id_for_label }}">
                üìÖ Term√≠n splnenia
            </label>
            {{ form.due_date }}
            {% if form.due_date.errors %}
                <ul class="errorlist">
                    {% for error in form.due_date.errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
            <small style="color: #718096; font-size: 0.8rem;">
                Kedy by mala by≈• √∫loha dokonƒçen√°
            </small>
        </div>

        <!-- Stav dokonƒçenia -->
        <div class="form-group">
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                {{ form.completed }}
                <label for="{{ form.completed.id_for_label }}" style="margin: 0;">
                    ‚úÖ √öloha je dokonƒçen√°
                </label>
            </div>
            {% if form.completed.errors %}
                <ul class="errorlist">
                    {% for error in form.completed.errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        </div>

        <!-- Tlaƒçidl√° -->
        <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem;">
            <button type="submit" class="btn btn-success">
                {% if form.instance.pk %}
                    üíæ Ulo≈æi≈• zmeny
                {% else %}
                    ‚ûï Vytvori≈• √∫lohu
                {% endif %}
            </button>

            <a href="{% url 'task_list' %}" class="btn btn-secondary">
                ‚Ü©Ô∏è Sp√§≈• na zoznam
            </a>
        </div>
    </form>
</div>

<style>
/* ≈†pecifick√© ≈°t√Ωly pre formul√°r */
.task-form input[type="checkbox"] {
    width: auto;
    margin-right: 0.5rem;
    transform: scale(1.2);
}

.task-form input[type="date"] {
    max-width: 200px;
}

.form-group small {
    display: block;
    margin-top: 0.25rem;
}

/* Responz√≠vne tlaƒçidl√° */
@media (max-width: 768px) {
    .form-container {
        margin: 1rem;
        padding: 1.5rem;
    }

    .form-container > div:last-child {
        flex-direction: column;
    }

    .form-container > div:last-child .btn {
        width: 100%;
        justify-content: center;
    }
}

/* Anim√°cie pre formul√°r */
.form-group {
    animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateX(-20px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Nastavenie minim√°lneho d√°tumu na dnes
    const dateInput = document.querySelector('input[type="date"]');
    if (dateInput) {
        const today = new Date().toISOString().split('T')[0];
        dateInput.setAttribute('min', today);
    }

    // Auto-focus na prv√© pole
    const titleInput = document.querySelector('input[name="title"]');
    if (titleInput) {
        titleInput.focus();
    }

    // Valid√°cia formul√°ra
    const form = document.querySelector('.task-form');
    if (form) {
        form.addEventListener('submit', function(e) {
            const title = document.querySelector('input[name="title"]').value.trim();

            if (!title) {
                e.preventDefault();
                alert('N√°zov √∫lohy je povinn√Ω!');
                return false;
            }

            if (title.length > 200) {
                e.preventDefault();
                alert('N√°zov √∫lohy je pr√≠li≈° dlh√Ω (max. 200 znakov)!');
                return false;
            }
        });
    }
});
</script>
{% endblock %}